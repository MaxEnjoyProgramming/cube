/*!
 * cube: cube.min.js
 * Authors  : 剪巽 <jianxun.zxl@taobao.com> (https://github.com/fishbar)
 * Create   : 2014-05-28 17:41:37
 * CopyRight 2014 (c) Alibaba Group
 */
!function(HOST,rename){function Cube(name,base){this.name=name?name:"_",this.base=base?base:Cube.BASE,this.charset=Cube.CHARSET?Cube.CHARSET:"utf-8"}function Require(mod){return Cube._cached[mod]}HOST._m_=function(name,require,cb){var ld=new Cube(name);ld.load(require,cb)},Cube.BASE="",Cube.CHARSET="utf-8",Cube.init=function(config){return config.base&&"/"!==config.base&&(this.BASE=config.base),config.charset&&(this.CHARSET=config.charset),this},Cube.use=function(mod,cb){var ll=new Cube;return ll.load(mod,function(module,exports,require){cb(require(mod))}),this},Cube._cached={},Cube._flag={},Cube._tree={},Cube.module=function(name){return this._cached[name]},Cube.prototype={load:function(require,cb){var mName=this.name;"string"==typeof require&&setTimeout(function(){var flag=!1;for(var i in Cube._flag){flag=!0;break}flag&&console.error("load script timeout:",require,mName)},5e3),require?"string"==typeof require&&(require=[require]):require=[];var len=require.length,_stack=[];if(this._load_stack={req:_stack,total:len,cb:cb,count:0},len)for(var tmp,i=0;len>i;i++)tmp=require[i],Cube.DEBUG&&(Cube._tree[tmp]||(Cube._tree[tmp]={}),Cube._tree[tmp][mName]=!0,this._checkCycle(tmp)),_stack.push(tmp),this._loadScript(tmp);else{var mod,module={exports:{}};cb&&(mod=cb.apply(HOST,[module,module.exports,Require,"",""])),mod?mod.__filename=this.name:mod=!0,Cube._cached[this.name]=mod,Cube.fire(this.name)}},_checkCycle:function(name,parents){parents||(parents=[name]);var tmp=Cube._tree[name];if(tmp)for(var i in tmp){if(-1!==parents.indexOf(i)){var message="cycle require : "+parents.join(">")+">"+i;throw new Error(message)}parents.push(i),this._checkCycle(i,parents.slice(0))}},_loadScript:function(name){function cb(mm){var flag=self._load_stack,ok=!1;if(Cube._cached[mm]&&(flag.count++,ok=self.name),flag.total<=flag.count){var mod,module={exports:{}},s_filename=self.name,s_dirname=s_filename.replace(/[^\/]*$/,"");flag.cb&&(mod=flag.cb.apply(HOST,[module,module.exports,Require,s_filename,s_dirname])),mod?mod.__filename=self.name:mod=!0,Cube._cached[self.name]=mod}return ok}var mod=Cube._cached[name],self=this,ww=Cube._flag;if(mod)return ww=cb(name),void(ww!==!1&&Cube.fire(ww));if(mod===!1)return void ww[name].push(cb);ww[name]||(ww[name]=[]),ww[name].push(cb),Cube._cached[name]=!1;var script=document.getElementsByTagName("head")[0].appendChild(document.createElement("script"));script.type="text/javascript",script.async="true",script.charset=this.charset;var _src=[this.base,name,"?m=1&",Cube.V];script.src=_src.join("")}},Cube.fire=function(name){var ww,flag,wts=Cube._flag,res={};if(ww=wts[name]){for(var n=ww.length-1;n>=0;n--)flag=ww[n](name),flag!==!1&&(ww.splice(n,1),n=ww.length,flag&&(res[flag]=!0));ww.length||delete wts[name];for(n in res)Cube.fire(n)}},rename=rename?rename:"Cube",HOST[rename]?console.log("window."+rename+' already in using, replace the last "null" param in cube.js'):HOST[rename]=Cube}(window,null);